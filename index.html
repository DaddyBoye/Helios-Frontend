<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <script src="https://telegram.org/js/telegram-web-app.js" strategy="beforeInteractive"></script>
    <link rel="icon" type="image/svg+xml" href="/src/images/MascotCircles.svg" />
    <title>Helios</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      window.Telegram.WebApp.expand();
      window.Telegram.WebApp.onEvent('auth', function() {
        const userData = window.Telegram.WebApp.initDataUnsafe;
        // Send the user data to your backend
        fetch('/api/telegram-login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(userData)
        })
        .then(response => response.json())
        .then(data => {
          // Store the JWT token from the backend
          const token = data.token;
          // Use the token with Supabase
          window.supabase.auth.setSession(token)
            .then(({ user, session, error }) => {
              if (error) {
                console.error('Error setting session:', error);
              } else {
                console.log('User logged in successfully:', user);
              }
            });
        })
        .catch(error => console.error('Error:', error));
      });
    </script>
  </body>
</html>
